/home/pmonteag/brevitas/src/brevitas_examples/llm/llm_args.py:455: UserWarning: Data loading can take a long time or, potentially, enter an infinite loop. Consider setting --args.fuse_sequences or decreasing the sequence length (seqlen)
  warn(
--- Logging error ---
Traceback (most recent call last):
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/logging/__init__.py", line 1086, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "<string>", line 1, in <module>
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/home/pmonteag/brevitas/src/brevitas_examples/common/benchmark/utils.py", line 164, in run_args_bucket_process
    results, _ = main_entrypoint(args, extra_args)
  File "/home/pmonteag/brevitas/src/brevitas_examples/llm/benchmark/llm_benchmark.py", line 45, in entrypoint_main
    return quantize_llm(args=args, extra_args=extra_args)
  File "/home/pmonteag/brevitas/src/brevitas_examples/llm/main.py", line 191, in quantize_llm
    calibration_loader = get_dataset_for_model(
  File "/home/pmonteag/brevitas/src/brevitas_examples/llm/llm_quant/data_utils.py", line 100, in get_dataset_for_model
    data = get_dataset_fn(
  File "/home/pmonteag/brevitas/src/brevitas_examples/llm/llm_quant/data.py", line 103, in get_wikitext2
    trainenc = tokenizer("\n\n".join(traindata['text']), return_tensors='pt')
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/site-packages/transformers/tokenization_utils_base.py", line 2860, in __call__
    encodings = self._call_one(text=text, text_pair=text_pair, **all_kwargs)
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/site-packages/transformers/tokenization_utils_base.py", line 2970, in _call_one
    return self.encode_plus(
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/site-packages/transformers/tokenization_utils_base.py", line 3046, in encode_plus
    return self._encode_plus(
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/site-packages/transformers/tokenization_utils_fast.py", line 600, in _encode_plus
    batched_output = self._batch_encode_plus(
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/site-packages/transformers/tokenization_utils_fast.py", line 573, in _batch_encode_plus
    self._eventual_warn_about_too_long_sequence(input_ids, max_length, verbose)
  File "/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/site-packages/transformers/tokenization_utils_base.py", line 3928, in _eventual_warn_about_too_long_sequence
    logger.warning(
Message: 'Token indices sequence length is longer than the specified maximum sequence length for this model (2436214 > 131072). Running this sequence through the model will result in indexing errors'
Arguments: ()
  0%|          | 0/128 [00:00<?, ?it/s]100%|██████████| 128/128 [00:00<00:00, 4238.61it/s]
  0%|          | 0/141 [00:00<?, ?it/s]100%|██████████| 141/141 [00:00<00:00, 14533.49it/s]
  0%|          | 0/800 [00:00<?, ?it/s]100%|██████████| 800/800 [00:00<00:00, 23014.80it/s]
Computing perplexity...:   0%|          | 0/141 [00:00<?, ?it/s]Computing perplexity...:   1%|▏         | 2/141 [00:00<00:16,  8.63it/s]Computing perplexity...:   2%|▏         | 3/141 [00:00<00:21,  6.44it/s]Computing perplexity...:   3%|▎         | 4/141 [00:00<00:23,  5.71it/s]Computing perplexity...:   4%|▎         | 5/141 [00:00<00:24,  5.47it/s]Computing perplexity...:   4%|▍         | 6/141 [00:01<00:26,  5.13it/s]Computing perplexity...:   5%|▍         | 7/141 [00:01<00:25,  5.32it/s]Computing perplexity...:   6%|▌         | 8/141 [00:01<00:25,  5.12it/s]Computing perplexity...:   6%|▋         | 9/141 [00:01<00:26,  4.97it/s]Computing perplexity...:   7%|▋         | 10/141 [00:01<00:28,  4.56it/s]Computing perplexity...:   8%|▊         | 11/141 [00:02<00:26,  4.87it/s]Computing perplexity...:   9%|▊         | 12/141 [00:02<00:28,  4.53it/s]Computing perplexity...:   9%|▉         | 13/141 [00:02<00:26,  4.84it/s]Computing perplexity...:  10%|▉         | 14/141 [00:02<00:26,  4.78it/s]Computing perplexity...:  11%|█         | 15/141 [00:02<00:26,  4.75it/s]Computing perplexity...:  11%|█▏        | 16/141 [00:03<00:26,  4.74it/s]Computing perplexity...:  12%|█▏        | 17/141 [00:03<00:26,  4.69it/s]Computing perplexity...:  13%|█▎        | 18/141 [00:03<00:26,  4.71it/s]Computing perplexity...:  13%|█▎        | 19/141 [00:03<00:26,  4.69it/s]Computing perplexity...:  14%|█▍        | 20/141 [00:04<00:25,  4.68it/s]Computing perplexity...:  15%|█▍        | 21/141 [00:04<00:25,  4.69it/s]Computing perplexity...:  16%|█▌        | 22/141 [00:04<00:23,  4.97it/s]Computing perplexity...:  16%|█▋        | 23/141 [00:04<00:24,  4.84it/s]Computing perplexity...:  17%|█▋        | 24/141 [00:04<00:24,  4.73it/s]Computing perplexity...:  18%|█▊        | 25/141 [00:05<00:23,  4.97it/s]Computing perplexity...:  18%|█▊        | 26/141 [00:05<00:24,  4.63it/s]Computing perplexity...:  19%|█▉        | 27/141 [00:05<00:24,  4.67it/s]Computing perplexity...:  20%|█▉        | 28/141 [00:05<00:24,  4.63it/s]Computing perplexity...:  21%|██        | 29/141 [00:05<00:24,  4.61it/s]Computing perplexity...:  21%|██▏       | 30/141 [00:06<00:24,  4.56it/s]Computing perplexity...:  22%|██▏       | 31/141 [00:06<00:24,  4.55it/s]Computing perplexity...:  23%|██▎       | 32/141 [00:06<00:22,  4.83it/s]Computing perplexity...:  23%|██▎       | 33/141 [00:06<00:22,  4.73it/s]Computing perplexity...:  24%|██▍       | 34/141 [00:06<00:21,  4.98it/s]Computing perplexity...:  25%|██▍       | 35/141 [00:07<00:20,  5.09it/s]Computing perplexity...:  26%|██▌       | 36/141 [00:07<00:20,  5.13it/s]Computing perplexity...:  26%|██▌       | 37/141 [00:07<00:19,  5.29it/s]Computing perplexity...:  27%|██▋       | 38/141 [00:07<00:19,  5.41it/s]Computing perplexity...:  28%|██▊       | 39/141 [00:07<00:19,  5.29it/s]Computing perplexity...:  28%|██▊       | 40/141 [00:08<00:19,  5.23it/s]Computing perplexity...:  29%|██▉       | 41/141 [00:08<00:19,  5.22it/s]Computing perplexity...:  30%|██▉       | 42/141 [00:08<00:19,  5.06it/s]Computing perplexity...:  30%|███       | 43/141 [00:08<00:19,  4.96it/s]Computing perplexity...:  31%|███       | 44/141 [00:08<00:18,  5.18it/s]Computing perplexity...:  32%|███▏      | 45/141 [00:09<00:18,  5.09it/s]Computing perplexity...:  33%|███▎      | 46/141 [00:09<00:19,  4.96it/s]Computing perplexity...:  33%|███▎      | 47/141 [00:09<00:19,  4.84it/s]Computing perplexity...:  34%|███▍      | 48/141 [00:09<00:19,  4.80it/s]Computing perplexity...:  35%|███▍      | 49/141 [00:09<00:18,  4.93it/s]Computing perplexity...:  35%|███▌      | 50/141 [00:10<00:18,  4.90it/s]Computing perplexity...:  36%|███▌      | 51/141 [00:10<00:18,  4.82it/s]Computing perplexity...:  37%|███▋      | 52/141 [00:10<00:18,  4.75it/s]Computing perplexity...:  38%|███▊      | 53/141 [00:10<00:18,  4.74it/s]Computing perplexity...:  38%|███▊      | 54/141 [00:10<00:18,  4.74it/s]Computing perplexity...:  39%|███▉      | 55/141 [00:11<00:18,  4.73it/s]Computing perplexity...:  40%|███▉      | 56/141 [00:11<00:17,  5.00it/s]Computing perplexity...:  40%|████      | 57/141 [00:11<00:16,  4.96it/s]Computing perplexity...:  41%|████      | 58/141 [00:11<00:16,  4.89it/s]Computing perplexity...:  42%|████▏     | 59/141 [00:11<00:16,  4.84it/s]Computing perplexity...:  43%|████▎     | 60/141 [00:12<00:16,  4.81it/s]Computing perplexity...:  43%|████▎     | 61/141 [00:12<00:16,  4.87it/s]Computing perplexity...:  44%|████▍     | 62/141 [00:12<00:16,  4.86it/s]Computing perplexity...:  45%|████▍     | 63/141 [00:12<00:16,  4.76it/s]Computing perplexity...:  45%|████▌     | 64/141 [00:13<00:16,  4.74it/s]Computing perplexity...:  46%|████▌     | 65/141 [00:13<00:16,  4.70it/s]Computing perplexity...:  47%|████▋     | 66/141 [00:13<00:16,  4.68it/s]Computing perplexity...:  48%|████▊     | 67/141 [00:13<00:15,  4.67it/s]Computing perplexity...:  48%|████▊     | 68/141 [00:13<00:14,  4.95it/s]Computing perplexity...:  49%|████▉     | 69/141 [00:14<00:15,  4.54it/s]Computing perplexity...:  50%|████▉     | 70/141 [00:14<00:14,  4.84it/s]Computing perplexity...:  50%|█████     | 71/141 [00:14<00:14,  4.77it/s]Computing perplexity...:  51%|█████     | 72/141 [00:14<00:14,  4.77it/s]Computing perplexity...:  52%|█████▏    | 73/141 [00:14<00:14,  4.75it/s]Computing perplexity...:  52%|█████▏    | 74/141 [00:15<00:14,  4.73it/s]Computing perplexity...:  53%|█████▎    | 75/141 [00:15<00:13,  4.75it/s]Computing perplexity...:  54%|█████▍    | 76/141 [00:15<00:12,  5.01it/s]Computing perplexity...:  55%|█████▍    | 77/141 [00:15<00:13,  4.87it/s]Computing perplexity...:  55%|█████▌    | 78/141 [00:15<00:13,  4.83it/s]Computing perplexity...:  56%|█████▌    | 79/141 [00:16<00:13,  4.75it/s]Computing perplexity...:  57%|█████▋    | 80/141 [00:16<00:12,  5.00it/s]Computing perplexity...:  57%|█████▋    | 81/141 [00:16<00:12,  4.86it/s]Computing perplexity...:  58%|█████▊    | 82/141 [00:16<00:12,  4.74it/s]Computing perplexity...:  59%|█████▉    | 83/141 [00:16<00:11,  5.00it/s]Computing perplexity...:  60%|█████▉    | 84/141 [00:17<00:11,  4.86it/s]Computing perplexity...:  60%|██████    | 85/141 [00:17<00:12,  4.54it/s]Computing perplexity...:  61%|██████    | 86/141 [00:17<00:12,  4.58it/s]Computing perplexity...:  62%|██████▏   | 87/141 [00:17<00:11,  4.56it/s]Computing perplexity...:  62%|██████▏   | 88/141 [00:18<00:10,  4.86it/s]Computing perplexity...:  63%|██████▎   | 89/141 [00:18<00:10,  4.77it/s]Computing perplexity...:  64%|██████▍   | 90/141 [00:18<00:10,  4.75it/s]Computing perplexity...:  65%|██████▍   | 91/141 [00:18<00:09,  5.00it/s]Computing perplexity...:  65%|██████▌   | 92/141 [00:18<00:09,  4.97it/s]Computing perplexity...:  66%|██████▌   | 93/141 [00:19<00:09,  5.08it/s]Computing perplexity...:  67%|██████▋   | 94/141 [00:19<00:08,  5.25it/s]Computing perplexity...:  67%|██████▋   | 95/141 [00:19<00:08,  5.25it/s]Computing perplexity...:  68%|██████▊   | 96/141 [00:19<00:08,  5.17it/s]Computing perplexity...:  69%|██████▉   | 97/141 [00:19<00:08,  5.33it/s]Computing perplexity...:  70%|██████▉   | 98/141 [00:19<00:07,  5.42it/s]Computing perplexity...:  70%|███████   | 99/141 [00:20<00:07,  5.50it/s]Computing perplexity...:  71%|███████   | 100/141 [00:20<00:07,  5.30it/s]Computing perplexity...:  72%|███████▏  | 101/141 [00:20<00:07,  5.22it/s]Computing perplexity...:  72%|███████▏  | 102/141 [00:20<00:07,  5.17it/s]Computing perplexity...:  73%|███████▎  | 103/141 [00:20<00:07,  5.33it/s]Computing perplexity...:  74%|███████▍  | 104/141 [00:21<00:07,  5.12it/s]Computing perplexity...:  74%|███████▍  | 105/141 [00:21<00:07,  4.94it/s]Computing perplexity...:  75%|███████▌  | 106/141 [00:21<00:07,  4.87it/s]Computing perplexity...:  76%|███████▌  | 107/141 [00:21<00:06,  5.09it/s]Computing perplexity...:  77%|███████▋  | 108/141 [00:21<00:06,  5.01it/s]Computing perplexity...:  77%|███████▋  | 109/141 [00:22<00:06,  4.91it/s]Computing perplexity...:  78%|███████▊  | 110/141 [00:22<00:06,  4.88it/s]Computing perplexity...:  79%|███████▊  | 111/141 [00:22<00:05,  5.10it/s]Computing perplexity...:  79%|███████▉  | 112/141 [00:22<00:05,  5.11it/s]Computing perplexity...:  80%|████████  | 113/141 [00:22<00:05,  4.97it/s]Computing perplexity...:  81%|████████  | 114/141 [00:23<00:05,  4.89it/s]Computing perplexity...:  82%|████████▏ | 115/141 [00:23<00:05,  4.76it/s]Computing perplexity...:  82%|████████▏ | 116/141 [00:23<00:04,  5.01it/s]Computing perplexity...:  83%|████████▎ | 117/141 [00:23<00:04,  4.91it/s]Computing perplexity...:  84%|████████▎ | 118/141 [00:23<00:04,  4.84it/s]Computing perplexity...:  84%|████████▍ | 119/141 [00:24<00:04,  4.75it/s]Computing perplexity...:  85%|████████▌ | 120/141 [00:24<00:04,  5.00it/s]Computing perplexity...:  86%|████████▌ | 121/141 [00:24<00:04,  4.91it/s]Computing perplexity...:  87%|████████▋ | 122/141 [00:24<00:03,  4.80it/s]Computing perplexity...:  87%|████████▋ | 123/141 [00:25<00:03,  4.81it/s]Computing perplexity...:  88%|████████▊ | 124/141 [00:25<00:03,  5.05it/s]Computing perplexity...:  89%|████████▊ | 125/141 [00:25<00:03,  4.94it/s]Computing perplexity...:  89%|████████▉ | 126/141 [00:25<00:03,  4.96it/s]Computing perplexity...:  90%|█████████ | 127/141 [00:25<00:02,  4.91it/s]Computing perplexity...:  91%|█████████ | 128/141 [00:26<00:02,  4.82it/s]Computing perplexity...:  91%|█████████▏| 129/141 [00:26<00:02,  5.05it/s]Computing perplexity...:  92%|█████████▏| 130/141 [00:26<00:02,  4.94it/s]Computing perplexity...:  93%|█████████▎| 131/141 [00:26<00:02,  4.88it/s]Computing perplexity...:  94%|█████████▎| 132/141 [00:26<00:01,  4.77it/s]Computing perplexity...:  94%|█████████▍| 133/141 [00:27<00:01,  4.72it/s]Computing perplexity...:  95%|█████████▌| 134/141 [00:27<00:01,  4.98it/s]Computing perplexity...:  96%|█████████▌| 135/141 [00:27<00:01,  4.88it/s]Computing perplexity...:  96%|█████████▋| 136/141 [00:27<00:01,  4.85it/s]Computing perplexity...:  97%|█████████▋| 137/141 [00:27<00:00,  5.05it/s]Computing perplexity...:  98%|█████████▊| 138/141 [00:28<00:00,  4.84it/s]Computing perplexity...:  99%|█████████▊| 139/141 [00:28<00:00,  4.78it/s]Computing perplexity...:  99%|█████████▉| 140/141 [00:28<00:00,  4.74it/s]Computing perplexity...: 100%|██████████| 141/141 [00:28<00:00,  4.70it/s]Computing perplexity...: 100%|██████████| 141/141 [00:28<00:00,  4.91it/s]
/home/pmonteag/brevitas/src/brevitas/graph/equalize.py:1750: UserWarning: Using parametrized results might break type-checking, which could lead to unexpected behaviour.
  warnings.warn(
/home/pmonteag/brevitas/src/brevitas_examples/llm/llm_quant/rotation_optimization.py:109: FutureWarning: `tokenizer` is deprecated and will be removed in version 5.0.0 for `DistilledTrainer.__init__`. Use `processing_class` instead.
  super().__init__(args=args, **kwargs)
  0%|          | 0/100 [00:00<?, ?it/s]/home/pmonteag/.local/miniforge3/envs/brv_llm_rocm/lib/python3.9/site-packages/torch/utils/checkpoint.py:87: UserWarning: None of the inputs have requires_grad=True. Gradients will be None
  warnings.warn(
  1%|          | 1/100 [00:32<53:40, 32.53s/it]  2%|▏         | 2/100 [01:05<53:12, 32.57s/it]  3%|▎         | 3/100 [01:35<51:17, 31.72s/it]  4%|▍         | 4/100 [02:08<51:04, 31.92s/it]  5%|▌         | 5/100 [02:41<51:32, 32.55s/it]  6%|▌         | 6/100 [03:13<50:36, 32.31s/it]  7%|▋         | 7/100 [03:44<49:16, 31.79s/it]  8%|▊         | 8/100 [04:16<48:46, 31.81s/it]  9%|▉         | 9/100 [04:46<47:46, 31.50s/it] 10%|█         | 10/100 [05:17<46:58, 31.32s/it]                                                 10%|█         | 10/100 [05:17<46:58, 31.32s/it] 11%|█         | 11/100 [05:50<46:55, 31.64s/it] 12%|█▏        | 12/100 [06:21<46:20, 31.60s/it] 13%|█▎        | 13/100 [06:53<46:00, 31.73s/it] 14%|█▍        | 14/100 [07:25<45:23, 31.66s/it] 15%|█▌        | 15/100 [07:57<45:08, 31.86s/it] 16%|█▌        | 16/100 [08:28<44:06, 31.50s/it] 17%|█▋        | 17/100 [09:02<44:34, 32.22s/it] 18%|█▊        | 18/100 [09:32<43:16, 31.66s/it] 19%|█▉        | 19/100 [10:04<42:58, 31.83s/it] 20%|██        | 20/100 [10:38<43:04, 32.31s/it]                                                 20%|██        | 20/100 [10:38<43:04, 32.31s/it] 21%|██        | 21/100 [11:07<41:31, 31.53s/it] 22%|██▏       | 22/100 [11:40<41:27, 31.89s/it] 23%|██▎       | 23/100 [12:11<40:29, 31.55s/it] 24%|██▍       | 24/100 [12:40<38:52, 30.69s/it] 25%|██▌       | 25/100 [13:11<38:40, 30.93s/it] 26%|██▌       | 26/100 [13:42<38:15, 31.02s/it] 27%|██▋       | 27/100 [14:12<37:15, 30.62s/it] 28%|██▊       | 28/100 [14:43<36:53, 30.74s/it] 29%|██▉       | 29/100 [15:13<36:04, 30.49s/it] 30%|███       | 30/100 [15:42<35:00, 30.01s/it]                                                 30%|███       | 30/100 [15:42<35:00, 30.01s/it] 31%|███       | 31/100 [16:15<35:27, 30.83s/it] 32%|███▏      | 32/100 [16:45<34:50, 30.74s/it] 33%|███▎      | 33/100 [17:16<34:18, 30.73s/it] 34%|███▍      | 34/100 [17:49<34:28, 31.33s/it] 35%|███▌      | 35/100 [18:21<34:12, 31.57s/it] 36%|███▌      | 36/100 [18:51<33:20, 31.26s/it] 37%|███▋      | 37/100 [19:22<32:41, 31.14s/it] 38%|███▊      | 38/100 [19:53<32:13, 31.19s/it] 39%|███▉      | 39/100 [20:25<31:42, 31.19s/it] 40%|████      | 40/100 [20:56<31:07, 31.13s/it]                                                 40%|████      | 40/100 [20:56<31:07, 31.13s/it] 41%|████      | 41/100 [21:26<30:32, 31.05s/it] 42%|████▏     | 42/100 [21:57<30:01, 31.06s/it] 43%|████▎     | 43/100 [22:28<29:27, 31.01s/it] 44%|████▍     | 44/100 [22:59<28:51, 30.93s/it] 45%|████▌     | 45/100 [23:30<28:28, 31.07s/it] 46%|████▌     | 46/100 [24:01<27:47, 30.88s/it] 47%|████▋     | 47/100 [24:33<27:33, 31.19s/it]